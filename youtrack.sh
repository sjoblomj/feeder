#!/bin/bash
url="$1"
curl -s 'https://youtrack.jetbrains.com/api/issues/JBR-3206?%24top=-1&fields=description,id,usesMarkdown,created,updated,summary,reporter(%40user),updater(%40user)%3B%40user%3AfullName,avatarUrl' --compressed -H 'Content-Type: application/json' | jq '{"id": .id, "title": .summary, "text": .description, "created": (if .created == null then null else .created / 1000 | strftime("%Y-%m-%dT%H:%M:%SZ") end), "updated": (if .updated == null then null else .updated / 1000 | strftime("%Y-%m-%dT%H:%M:%SZ") end), "usesMarkdown": .usesMarkdown, "reporter": {"name": .reporter.fullName, "userPicture": .reporter.avatarUrl}, "updater": {"name": .updater.fullName, "userPicture": .updater.avatarUrl}}'

curl -s 'https://youtrack.jetbrains.com/api/issues/JBR-3206/activitiesPage?categories=CommentsCategory&reverse=true&fields=activities(added(author(name,avatarUrl),id,updated,created,text,usesMarkdown,files),timestamp)' -H 'Content-Type: application/json' | jq '.activities | map(.added.[]) | map({"id": .id, "user": .author.name, "userPicture": .author.avatarUrl, "text": .text, "usesMarkdown": .usesMarkdown, "created": (if .created == null then null else .created / 1000 | strftime("%Y-%m-%dT%H:%M:%SZ") end), "updated": (if .updated == null then null else .updated / 1000 | strftime("%Y-%m-%dT%H:%M:%SZ") end)}) | sort_by(.created)'
